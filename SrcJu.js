//Êú¨‰ª£Á†Å‰ªÖÁî®‰∫é‰∏™‰∫∫Â≠¶‰π†ÔºåËØ∑ÂãøÁî®‰∫éÂÖ∂‰ªñ‰ΩúÁî®Ôºå‰∏ãËΩΩÂêéËØ∑24Â∞èÊó∂ÂÜÖÂà†Èô§Ôºå‰ª£Á†ÅËôΩÁÑ∂ÊòØÂÖ¨ÂºÄÂ≠¶‰π†ÁöÑÔºå‰ΩÜËØ∑Â∞äÈáç‰ΩúËÄÖÔºåÂ∫îÁïô‰∏ãËØ¥Êòé
//ËÅöÈõÜÂûã„ÄÅÊé•Âè£Âûã„ÄÅÂπ≥Âè∞ÂûãÁ©∫Â£≥Â∞èÁ®ãÂ∫èÔºåÊé•Âè£ÂàÜ‰∏∫‰∏ªÈ°µÊ∫êÂíåÊêúÁ¥¢Ê∫ê
let publicfile;
try{
    publicfile = config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuPublic.js';
}catch(e){
    let cfgfile = "hiker://files/rules/Src/Ju/config.json";
    if (fileExist(cfgfile)) {
        eval("let Juconfig=" + fetch(cfgfile) + ";");
        publicfile = Juconfig["‰æùËµñ"].match(/http(s)?:\/\/.*\//)[0] + 'SrcJuPublic.js';
    }
}
require(publicfile);

//‰∏ÄÁ∫ß
function yiji() {
    let sourcedata = yidatalist.filter(it => {
        return it.name==sourcename && it.type==runMode;
    });
    let parse = {};
    let È°µÁ†Å = {};
    let ËΩ¨Êç¢ = {};
    let runType;
    try {
        if (sourcedata.length > 0) {
            eval("let source = " + sourcedata[0].parse);
            if (source.ext && /^http/.test(source.ext)) {
                requireCache(source.ext, 48);
                parse = yidata;
            } else {
                parse = source;
            }
            runType = sourcedata[0].type;
            storage0.putMyVar('‰∏ÄÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ',{name: sourcename, type: runType, group: sourcedata[0].group, img: sourcedata[0].img});//‰º†ÂØºÁªôÊñπÊ≥ïÊñá‰ª∂
            try{
                require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuMethod.js');
                cacheData(sourcedata[0]);
            }catch(e){
                //xlog("‚àöÁºìÂ≠ò‰∏¥Êó∂Êñá‰ª∂Â§±Ë¥•>"+e.message);
            }
            È°µÁ†Å = parse["È°µÁ†Å"];
            ËΩ¨Êç¢ = parse["ËΩ¨Êç¢"];
            let ÊèêÁ§∫ = "ÂΩìÂâç‰∏ªÈ°µÊ∫êÔºö" + sourcename + (parse["‰ΩúËÄÖ"] ? "Ôºå‰ΩúËÄÖÔºö" + parse["‰ΩúËÄÖ"] : "");
            if(!getMyVar(runMode+"_"+sourcename)){
                toast(ÊèêÁ§∫);
            }
        }
    } catch (e) {
        xlog("‚àö‰∏ÄÁ∫ßÊ∫êÊé•Âè£Âä†ËΩΩÂºÇÂ∏∏>" + e.message);
    }
    È°µÁ†Å = È°µÁ†Å || {};
    ËΩ¨Êç¢ = ËΩ¨Êç¢ || {};
    let d = [];
    if(MY_PAGE==1){
        if(getMyVar('SrcJu_versionCheck', '0') == '0'){
            let programversion = $.require("config").version || 0;
            if(programversion<14){
                confirm({
                    title: "Ê∏©È¶®ÊèêÁ§∫",
                    content: "ÂèëÁé∞Â∞èÁ®ãÂ∫èÊñ∞ÁâàÊú¨",
                    confirm: $.toString(() => {
                        return "Êµ∑ÈòîËßÜÁïåÈ¶ñÈ°µÈ¢ëÈÅìËßÑÂàô„ÄêËÅöÈòÖ‚àö„ÄëÔø•home_rule_urlÔø•http://hiker.nokia.press/hikerule/rulelist.json?id=6337"
                    }),
                    cancel: $.toString(() => {
                        return "toast://‰∏çÂçáÁ∫ßÂ∞èÁ®ãÂ∫èÔºåÂàôÂäüËÉΩ‰∏çÂÖ®ÊàñÊúâÂºÇÂ∏∏"
                    })
                });
            }
            Version();
            downloadicon();
        }
        
        d.push({
            title: "ÁÆ°ÁêÜ",
            url: $("hiker://empty#noRecordHistory##noHistory#").rule(() => {
                require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuSet.js');
                SRCSet();
            }),
            pic_url: "https://hikerfans.com/tubiao/more/129.png",
            col_type: 'icon_5',
            extra: {
                newWindow: true,
                windowId: MY_RULE.title + "ÁÆ°ÁêÜ"
            }
        })
        let zz = ËΩ¨Êç¢["ÊéíË°å"] || "ÊéíË°å";
        if(parse&&parse[zz]){
            d.push({
                title: zz,
                url: rulePage(zz,È°µÁ†Å[zz]),
                pic_url: "https://hikerfans.com/tubiao/more/229.png",
                col_type: 'icon_5'
            })
        }else{
            d.push({
                title: "Êî∂Ëóè",
                url: "hiker://collection?rule="+MY_RULE.title,
                pic_url: "https://hikerfans.com/tubiao/more/109.png",
                col_type: 'icon_5'
            })
        }
        let sousuoextra = {
            id: "sousuopageid",
            newWindow: true,
            windowId: MY_RULE.title + "ÊêúÁ¥¢È°µ",
            longClick: [{
                title: "üîçÊêúÁ¥¢",
                js: $.toString(() => {
                    return $("hiker://empty#noRefresh##noRecordHistory##noHistory##fullTheme###fypage").rule(() => {
                        require(config.‰æùËµñ);
                        newsousuopage();
                    })
                })
            },{
                title: "üîéËÅöÊêú‰ª£ÁêÜÔºö"+(getItem('searchmode')=="jusousuo"?"ÊòØ":"Âê¶"),
                js: $.toString(() => {
                    if(getItem('searchmode')=="jusousuo"){
                        clearItem('searchmode');
                        return "toast://ÂèñÊ∂àËΩØ‰ª∂ËÅöÊêú‰ª£ÁêÜÔºåËµ∞Â∞èÁ®ãÂ∫èËÅöÊêú";
                    }else{
                        setItem('searchmode', "jusousuo");
                        return "toast://ÂºÄÂêØËΩØ‰ª∂ËÅöÊêú‰ª£ÁêÜÔºåËµ∞ËΩØ‰ª∂ËÅöÊêú";
                    }
                })
            }]
        }
        
        zz = ËΩ¨Êç¢["ÂàÜÁ±ª"] || "ÂàÜÁ±ª";
        if(parse&&parse[zz]){
            d.push({
                title: zz,
                url: $('#noLoading#').lazyRule((sousuoextra,ispage,zz) => {
                        delete sousuoextra.newWindow;
                        updateItem("sousuopageid",{extra:sousuoextra});
                        return $("hiker://empty#noRecordHistory##noHistory#" + (ispage ? "?page=fypage" : "")).rule((sousuoextra,zz) => {
                            addListener("onClose", $.toString((sousuoextra) => {
                                sousuoextra.newWindow = true;
                                updateItem("sousuopageid",{extra:sousuoextra});
                            },sousuoextra));
                            require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuPublic.js');
                            getYiData(zz);
                        },sousuoextra,zz)
                    },sousuoextra,È°µÁ†Å[zz],zz),
                pic_url: "https://hikerfans.com/tubiao/more/287.png",
                col_type: 'icon_5',
                extra: sousuoextra
            })
        }else{
            d.push({
                title: "ÊêúÁ¥¢",
                url: $("hiker://empty#noRefresh##noRecordHistory##noHistory##fullTheme###fypage").rule(() => {
                    require(config.‰æùËµñ);
                    newsousuopage();
                }),
                pic_url: "https://hikerfans.com/tubiao/more/101.png",
                col_type: 'icon_5',
                extra: sousuoextra
            })
        }
        zz = ËΩ¨Êç¢["Êõ¥Êñ∞"] || "Êõ¥Êñ∞";
        if(parse&&parse[zz]){
            d.push({
                title: zz,
                url: rulePage(zz,È°µÁ†Å[zz]),
                pic_url: "https://hikerfans.com/tubiao/more/288.png",
                col_type: 'icon_5'
            })
        }else{
            d.push({
                title: "ÂéÜÂè≤",
                url: "hiker://history?rule="+MY_RULE.title,
                pic_url: "https://hikerfans.com/tubiao/more/213.png",
                col_type: 'icon_5'
            })
        }
        
        d.push({
            title: Juconfig["btnmenu5"] || "‰π¶Êû∂",
            url: Juconfig["btnmenu5"] == "ÂéÜÂè≤" ? "hiker://history?rule="+MY_RULE.title : Juconfig["btnmenu5"] == "Êî∂Ëóè" ? "hiker://collection?rule="+MY_RULE.title : $("hiker://empty###noRecordHistory##noHistory#").rule(() => {
                require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcBookCase.js');
                bookCase();
            }),
            pic_url: "https://hikerfans.com/tubiao/more/286.png",
            col_type: 'icon_5',
            extra: {
                longClick: [{
                    title: "ÂàáÊç¢ÊåâÈíÆ",
                    js: $.toString(() => {
                        require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuPublic.js');
                        return $(["‰π¶Êû∂", "Êî∂Ëóè", "ÂéÜÂè≤"], 1).select((cfgfile, Juconfig) => {
                            Juconfig["btnmenu5"] = input;
                            writeFile(cfgfile, JSON.stringify(Juconfig));
                            refreshPage(false);
                            return 'toast://Â∑≤ÂàáÊç¢‰∏∫' + input;
                        }, cfgfile, Juconfig)
                    })
                }]
            }
        })

        let typemenubtn = getTypeNames("‰∏ªÈ°µ");
        typemenubtn.forEach((it) =>{
            let item = {
                title: runMode==it?`‚Äú‚Äú‚Äù‚Äù<b><span style="color: #3399cc">`+it+`</span></b>`:it,
                url: runMode==it?$('#noLoading#').lazyRule((input) => {
                    require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuPublic.js');
                    return selectSource(input);
                }, it):$('#noLoading#').lazyRule((cfgfile,Juconfig,input) => {
                    Juconfig["runMode"] = input;
                    writeFile(cfgfile, JSON.stringify(Juconfig));
                    refreshPage(false);
                    return 'toast://‰∏ªÈ°µÊ∫êÂàÜÁ±ªÂàÜÁªÑÂ∑≤ÂàáÊç¢‰∏∫Ôºö' + input;
                }, cfgfile, Juconfig ,it),
                col_type: "scroll_button"//runModes_btntype
            }
            if(runMode==it){
                item.extra = {
                    longClick: [{
                        title: "Âà†Èô§ÂΩìÂâç",
                        js: $.toString((sourcefile,id) => {
                            return $("Á°ÆÂÆöÂà†Èô§Ôºö"+id).confirm((sourcefile,id)=>{
                                let sourcedata = fetch(sourcefile);
                                eval("var datalist=" + sourcedata + ";");
                                let index = datalist.indexOf(datalist.filter(d => d.type+"_"+d.name == id)[0]);
                                datalist.splice(index, 1);
                                writeFile(sourcefile, JSON.stringify(datalist));
                                clearMyVar('SrcJu_searchMark');
                                return 'toast://Â∑≤Âà†Èô§';
                            },sourcefile,id)
                        }, sourcefile, runType+"_"+sourcename)
                    },{
                        title: "ÂàóË°®ÊéíÂ∫èÔºö" + getItem("sourceListSort", "update"),
                        js: $.toString(() => {
                            return $(["Êõ¥Êñ∞Êó∂Èó¥","Êé•Âè£ÂêçÁß∞"], 1).select(() => {
                                if(input=='Êé•Âè£ÂêçÁß∞'){
                                    setItem("sourceListSort","name");
                                }else{
                                    clearItem("sourceListSort");
                                }
                                //refreshPage(false);
                            })
                        })
                    }]
                }
            }
            d.push(item);
        })
        d.push({
            col_type: "blank_block"
        })
        putMyVar(runMode+"_"+sourcename, "1");
    }
    //Âä†ËΩΩ‰∏ªÈ°µÂÜÖÂÆπ
    getYiData('‰∏ªÈ°µ', d);
}

//‰∫åÁ∫ß+Ê∫êÊêúÁ¥¢
function erji() {
    addListener("onClose", $.toString((isback,surl) => {
        clearMyVar('‰∫åÁ∫ßËØ¶ÊÉÖ‰∏¥Êó∂ÂØπË±°');
        clearMyVar('‰∫åÁ∫ßÈôÑÂä†‰∏¥Êó∂ÂØπË±°');
        clearMyVar('‰∫åÁ∫ßÁÆÄ‰ªãÊâìÂºÄÊ†áËØÜ');
        clearMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id');
        clearMyVar('‰∫åÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ');
        clearMyVar('Âä†ËΩΩÂºÇÂ∏∏Ëá™Âä®Êç¢Ê∫ê');
        if(getMyVar('‰ªé‰π¶Êû∂Ëøõ‰∫åÁ∫ß')){
            clearMyVar('‰ªé‰π¶Êû∂Ëøõ‰∫åÁ∫ß');
            refreshPage(false);
        }
        if(isback && surl!=getMyVar('rulepageid')){
            back(false);
        }else{
            clearMyVar('rulepageid');
        }
    },MY_PARAMS.back||0, MY_PARAMS.surl));
    addListener('onRefresh', $.toString(() => {
        putMyVar('Âä†ËΩΩÂºÇÂ∏∏Ëá™Âä®Êç¢Ê∫ê','1');
    }));
    //Áî®‰∫é‰∫åÁ∫ßÂ•óÂ®ÉËá™Âä®ËøîÂõûËÆ°Êï∞
    if(MY_PARAMS.back && !getMyVar('rulepageid')){
        putMyVar('rulepageid', MY_PARAMS.surl);
    }
    clearMyVar('‰∫åÁ∫ßÂä†ËΩΩÊâ©Â±ïÂàóË°®');
    let isload;//ÊòØÂê¶Ê≠£Á°ÆÂä†ËΩΩ
    let sauthor;
    let detailsfile = "hiker://files/_cache/SrcJu_details.json";
    let erjidetails = storage0.getMyVar('‰∫åÁ∫ßËØ¶ÊÉÖ‰∏¥Êó∂ÂØπË±°') || {};//‰∫åÁ∫ßÊµ∑Êä•Á≠âËØ¶ÊÉÖ‰∏¥Êó∂‰øùÂ≠ò
    erjidetails.name = MY_PARAMS.name || erjidetails.name || "";
    let name = erjidetails.name.replace(/‚Äò|‚Äô|‚Äú|‚Äù|<[^>]+>|ÂÖ®ÈõÜ|ÂõΩËØ≠|Á≤§ËØ≠/g,"").trim();
    let myerjiextra = storage0.getMyVar('‰∫åÁ∫ßÈôÑÂä†‰∏¥Êó∂ÂØπË±°') || {};//‰∫åÁ∫ßÊç¢Ê∫êÊó∂‰∏¥Êó∂extraÊï∞ÊçÆ
    let d = [];
    let parse = {};
    let ÂÖ¨ÂÖ±;
    let Ê†áËØÜ;
    let details;
    let stype = MY_PARAMS.stype;
    let smark = getMark(name, stype);//Ë∂≥ËøπËÆ∞ÂΩï
    let extrasource = [myerjiextra, MY_PARAMS, smark];
    let erjiextra;
    let sname;
    let surl;
    let sgroup;
    let lineid = smark.lineid || 0;
    let pageid = smark.pageid || 0;
    let detailload;
    let oldMY_PARAMS = Object.assign({}, MY_PARAMS);
    let pic;
    for(let i=0; i<extrasource.length; i++){
        sname = extrasource[i].sname || "";
        surl = extrasource[i].surl || "";
        if(sname&&surl){
            erjiextra = extrasource[i];
            break;
        }
    }
    
    //ÂåπÈÖçÂèñÊé•Âè£Êï∞ÊçÆ
    let sourcedata = erdatalist.filter(it => {
        return it.name == sname && it.type == stype;
    });
    let sourcedata2;//Áî®‰∫éÊ≠£Â∏∏Âä†ËΩΩÊó∂ÔºåÂ∞Ü‰∫åÁ∫ßÊé•Âè£Â≠òÂÖ•ÂΩìÂâçÈ°µÈù¢PARAMSÔºåÁ°Æ‰øùÂàÜ‰∫´Êó∂ÂèØ‰ª•ÊâìÂºÄ
    try {
        if (sourcedata.length == 0 && MY_PARAMS && MY_PARAMS.sourcedata) {
            sourcedata.push(MY_PARAMS.sourcedata);
        }
        if (sourcedata.length > 0 && sourcedata[0].erparse) {
            eval("let source = " + sourcedata[0].erparse);
            if (source.ext && /^http/.test(source.ext)) {
                requireCache(source.ext, 48);
                parse = erdata;
            } else {
                parse = source;
            }
            sourcedata2 = sourcedata[0];
            sgroup = sourcedata2.group;
            storage0.putMyVar('‰∫åÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ',{name: sname, type: stype, group: sgroup||"", img: sourcedata[0].img||""});
            
            try{
                require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuMethod.js');
                cacheData(sourcedata[0]);
            }catch(e){
                //log("‚àöÁºìÂ≠ò‰∏¥Êó∂Êñá‰ª∂Â§±Ë¥•>"+e.message);
            }
        }
        sauthor = parse["‰ΩúËÄÖ"];
    } catch (e) {
        xlog("‚àöÂä†ËΩΩÊêúÁ¥¢Ê∫êÊé•Âè£‰ª£Á†ÅÈîôËØØ>"+e.message);
    }
    try {
        if (parse && surl) {
            try{
                eval("let gonggong = " + sourcedata[0].public);
                if (gonggong && gonggong.ext && /^http/.test(gonggong.ext)) {
                    requireCache(gonggong.ext, 48);
                    gonggong = ggdata;
                }
                ÂÖ¨ÂÖ± = gonggong || parse['ÂÖ¨ÂÖ±'] || {};
                if(ÂÖ¨ÂÖ±['È¢ÑÂ§ÑÁêÜ']){
                    try{
                        ÂÖ¨ÂÖ±['È¢ÑÂ§ÑÁêÜ']();
                    }catch(e){
                        xlog('‚àöÊâßË°åÈ¢ÑÂ§ÑÁêÜÊä•ÈîôÔºå‰ø°ÊÅØ>'+e.message);
                    }
                }
            }catch(e){
                xlog("‚àöÂä†ËΩΩÂÖ¨ÂÖ±‰ª£Á†ÅÈîôËØØ>"+e.message);
            }
            
            Ê†áËØÜ = stype + "_" + sname;
            MY_URL = surl;
            let detailsmark;
            if(getMyVar('ÊòØÂê¶ÂèñÁºìÂ≠òÊñá‰ª∂') && getMyVar('‰∏ÄÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ') && !getMyVar("SrcJu_Ë∞ÉËØïÊ®°Âºè")){
                let detailsdata = fetch(detailsfile);
                if (detailsdata != "") {
                    try{
                        eval("let detailsjson=" + detailsdata + ";");
                        if(detailsjson.sname==sname && detailsjson.surl==surl){
                            detailsmark = detailsjson;//Êú¨Âú∞ÁºìÂ≠òÊé•Âè£+ÈìæÊé•ÂØπÂæó‰∏äÂàôÂèñÊú¨Âú∞ÔºåÁî®‰∫éÂàáÊç¢ÊéíÂ∫èÂíåÊ†∑ÂºèÊó∂Âä†Âø´
                        }
                    }catch(e){ }
                }
            }
            //Êñπ‰æøÊç¢Ê∫êÊó∂‰∫åÁ∫ß‰ª£Á†Å‰∏≠‰ΩøÁî®MY_PARAMS
            MY_PARAMS = erjiextra;
            if(detailsmark){
                details = detailsmark;
            }else{
                try{
                    eval("let ‰∫åÁ∫ßËé∑Âèñ = " + parse['‰∫åÁ∫ß'])
                    details = ‰∫åÁ∫ßËé∑Âèñ(surl);
                }catch(e){
                    details = {};
                    xlog("‚àö‰∫åÁ∫ßËé∑ÂèñÊï∞ÊçÆÈîôËØØ>"+e.message);
                }
            }
            
            pic = details.img || oldMY_PARAMS.img;// || "https://p1.ssl.qhimgs1.com/sdr/400__/t018d6e64991221597b.jpg";
            pic = pic&&pic.indexOf("@Referer=") == -1 ? pic + "@Referer=" : pic;
            erjiextra.img = pic;
            erjidetails.img = erjiextra.img || erjidetails.img;
            erjidetails.detail1 = details.detail1 || erjidetails.detail1;
            erjidetails.detail2 =  details.detail2 || erjidetails.detail2;
            erjidetails.desc = details.desc || erjidetails.desc;
            let detailextra = details.detailextra || {};
            detailextra.id = "detailid";
            detailextra.gradient = detailextra.gradient || true;
            d.push({
                title: erjidetails.detail1 || "",
                desc: erjidetails.detail2 || "",
                pic_url: erjidetails.img,
                url: details.detailurl || (/^http/.test(surl)?surl+'#noRecordHistory##noHistory#':erjidetails.img),
                col_type: 'movie_1_vertical_pic_blur',
                extra: detailextra
            })
            detailload = 1;
            lineid = parseInt(getMyVar("SrcJu_"+surl+"_line", lineid.toString()));
            pageid = parseInt(getMyVar("SrcJu_"+surl+"_page", pageid.toString()));

            let Á∫øË∑Øs = ["Á∫øË∑Ø"];
            let ÂàóË°®s = [[]];
            try{
                Á∫øË∑Øs = details.line?details.line:["Á∫øË∑Ø"];
                ÂàóË°®s = details.line?details.list:[details.list];
                if(Á∫øË∑Øs.length != ÂàóË°®s.length){
                    xlog('‚àö'+sname+'>Ê∫êÊé•Âè£ËøîÂõûÁöÑÁ∫øË∑ØÊï∞'+Á∫øË∑Øs.length+'ÂíåÂàóË°®Êï∞'+ÂàóË°®s.length+'‰∏çÁõ∏Á≠â');
                }
            }catch(e){
                xlog('‚àö'+sname+">Á∫øË∑ØÊàñÂàóË°®ËøîÂõûÊï∞ÊçÆÊúâËØØ>"+e.message);
            }
            if(details.listparse){//ÈÄâÈõÜÂàóË°®ÈúÄË¶ÅÂä®ÊÄÅËß£ÊûêËé∑Âèñ
                let Á∫øË∑ØÈÄâÈõÜ = details.listparse(lineid,Á∫øË∑Øs[lineid]) || [];
                if(Á∫øË∑ØÈÄâÈõÜ.length>0){
                    ÂàóË°®s[lineid] = Á∫øË∑ØÈÄâÈõÜ;
                }
            }
            if(details.page && details.pageparse){//ÁΩëÁ´ôÂàÜÈ°µÊòæÁ§∫ÂàóË°®ÁöÑÔºåÈúÄË¶ÅÂä®ÊÄÅËß£ÊûêËé∑Âèñ
                try{
                    if((detailsmark && pageid != details.pageid) || (!detailsmark && pageid>0)){
                        let ÂàÜÈ°µs = details.page;
                        if(pageid > ÂàÜÈ°µs.length){
                            pageid = 0;
                        }
                        let ÂàÜÈ°µÈÄâÈõÜ = details.pageparse(ÂàÜÈ°µs[pageid].url);
                        if($.type(ÂàÜÈ°µÈÄâÈõÜ)=="array"){
                            ÂàóË°®s[lineid] = ÂàÜÈ°µÈÄâÈõÜ;
                            details.list = details.line?ÂàóË°®s:ÂàÜÈ°µÈÄâÈõÜ;
                        }
                    }
                }catch(e){
                    xlog('‚àö'+sname+'ÂàÜÈ°µÈÄâÈõÜÂ§ÑÁêÜÂ§±Ë¥•>'+e.message);
                }
            }
            
            if(lineid > ÂàóË°®s.length-1){
                toast('ÈÄâÊã©ÁöÑÁ∫øË∑ØÊó†ÈÄâÈõÜÔºåÂ∞ÜÊòæÁ§∫Á¨¨1Á∫øË∑Ø');
                lineid = 0;
            }

            let ÂàóË°® = ÂàóË°®s[lineid] || [];
            if(ÂàóË°®.length>0){
                try{
                    let i1 = parseInt(ÂàóË°®.length / 6);
                    let i2 = parseInt(ÂàóË°®.length / 4);
                    let i3 = parseInt(ÂàóË°®.length / 2);
                    let list1 = ÂàóË°®[i1].title;
                    let list2 = ÂàóË°®[i2].title;
                    let list3 = ÂàóË°®[i3].title;
                    if(parseInt(list1.match(/(\d+)/)[0])>parseInt(list2.match(/(\d+)/)[0]) && parseInt(list2.match(/(\d+)/)[0])>parseInt(list3.match(/(\d+)/)[0])){
                        ÂàóË°®.reverse();
                    }
                }catch(e){
                    //xlog('‚àöÂº∫Âà∂‰øÆÊ≠£ÈÄâÈõÜÈ°∫Â∫èÂ§±Ë¥•>'+e.message)
                }
            }
            if (getMyVar(sname + 'sort') == '1') {
                ÂàóË°®.reverse();
            }

            let itype = stype=="Êº´Áîª"?"comic":stype=="Â∞èËØ¥"?"novel":"";
            let Ëß£Êûê = parse['Ëß£Êûê'];
            let lazy = $("").lazyRule((Ëß£Êûê,ÂèÇÊï∞) => {
                let url = input.split("##")[1];
                let ÂÖ¨ÂÖ± = {};
                try{
                    ÂÖ¨ÂÖ± = $.require('jiekou'+(/ËÅöÈòÖ/.test(ÂèÇÊï∞.ËßÑÂàôÂêç)?'':'?rule=ËÅöÈòÖ‚àö')).ÂÖ¨ÂÖ±(ÂèÇÊï∞.Ê†áËØÜ);
                }catch(e){
                    toast('Êú™ÊâæÂà∞ËÅöÈòÖËßÑÂàôÂ≠êÈ°µÈù¢');
                }
                eval("let Ëß£Êûê2 = " + Ëß£Êûê);
                let Ê†áËØÜ = ÂèÇÊï∞.Ê†áËØÜ;
                return Ëß£Êûê2(url,ÂÖ¨ÂÖ±,ÂèÇÊï∞);
            }, Ëß£Êûê, {"ËßÑÂàôÂêç": MY_RULE._title || MY_RULE.title, "Ê†áËØÜ": Ê†áËØÜ});
            
            let download = $.toString((Ëß£Êûê,ÂÖ¨ÂÖ±,ÂèÇÊï∞) => {
                eval("let Ëß£Êûê2 = " + Ëß£Êûê);
                let Ê†áËØÜ = ÂèÇÊï∞.Ê†áËØÜ;
                return Ëß£Êûê2(input,ÂÖ¨ÂÖ±,ÂèÇÊï∞);
            }, Ëß£Êûê, ÂÖ¨ÂÖ±, {"ËßÑÂàôÂêç": MY_RULE._title || MY_RULE.title, "Ê†áËØÜ": Ê†áËØÜ});

            d.push({
                title: "ËØ¶ÊÉÖÁÆÄ‰ªã",
                url: $("#noLoading#").lazyRule((desc) => {
                    if(getMyVar('‰∫åÁ∫ßÁÆÄ‰ªãÊâìÂºÄÊ†áËØÜ')=="1"){
                        clearMyVar('‰∫åÁ∫ßÁÆÄ‰ªãÊâìÂºÄÊ†áËØÜ');
                        deleteItemByCls("SrcJudescload");
                    }else{
                        putMyVar('‰∫åÁ∫ßÁÆÄ‰ªãÊâìÂºÄÊ†áËØÜ',"1");
                        addItemAfter('detailid', [{
                            title: `<font color="#098AC1">ËØ¶ÊÉÖÁÆÄ‰ªã </font><small><font color="#f47983"> ></font></small>`,
                            col_type: "avatar",
                            url: $("#noLoading#").lazyRule(() => {
                                clearMyVar('‰∫åÁ∫ßÁÆÄ‰ªãÊâìÂºÄÊ†áËØÜ');
                                deleteItemByCls("SrcJudescload");
                                return "hiker://empty";
                            }),
                            pic_url: "https://hikerfans.com/tubiao/ke/91.png",
                            extra: {
                                cls: "SrcJudescload"
                            }
                        },{
                            title: desc,
                            col_type: "rich_text",
                            extra: {
                                cls: "SrcJudescload"
                            }
                        }]);
                    }
                    return "hiker://empty";
                }, erjidetails.desc||""),
                pic_url: "https://hikerfans.com/tubiao/messy/32.svg",
                col_type: 'icon_small_3',
                extra: {
                    cls: "Juloadlist"
                }
            })
            let sskeyword = name.split('/')[0].trim();
            if(stype=="ÂΩ±ËßÜ"){
                d.push({
                    title: "ËÅöÂΩ±ÊêúÁ¥¢",
                    url: JySearch(sskeyword, getItem("juyingSeachType")),
                    pic_url: 'https://hikerfans.com/tubiao/messy/25.svg',
                    col_type: 'icon_small_3',
                    extra: {
                        cls: "Juloadlist",
                        longClick: [{
                            title: "ÊêúÁ¥¢Á±ªÂûãÔºö" + getItem("juyingSeachType", "ÈªòËÆ§"),
                            js: $.toString(() => {
                                return $(["ËÅöÊêúÊé•Âè£","‰∫ëÁõòÊé•Âè£","AlistÊé•Âè£"], 3).select(() => {
                                    setItem("juyingSeachType",input);
                                    refreshPage(false);
                                })
                            })
                        }]
                    }
                })
            }else{
                d.push({
                    title: "‰π¶Êû∂/‰∏ãËΩΩ",
                    url: $("hiker://empty###noRecordHistory##noHistory#").rule(() => {
                        require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcBookCase.js');
                        bookCase();
                    }),
                    pic_url: 'https://hikerfans.com/tubiao/messy/70.svg',
                    col_type: 'icon_small_3',
                    extra: {
                        cls: "Juloadlist",
                        inheritTitle: false,
                        longClick: [{
                            title: "‰∏ãËΩΩÊú¨Âú∞üì•",
                            js: $.toString((itype) => {
                                if(itype){
                                    return "hiker://page/download.view#noRecordHistory##noRefresh##noHistory#?rule=Êú¨Âú∞ËµÑÊ∫êÁÆ°ÁêÜ"
                                }else{
                                    return "toast://‰∏çÊîØÊåÅ‰∏ãËΩΩÁöÑÁ±ªÂûã"
                                }
                            },itype)
                        }],
                        chapterList: ÂàóË°®,
                        "defaultView": "1",
                        "info": {
                            "bookName": name,
                            "bookTopPic": pic,
                            "parseCode": download,
                            "ruleName": MY_RULE._title || MY_RULE.title,
                            "type": itype,
                            "decode": ÂÖ¨ÂÖ±["imgdec"]?$.type(ÂÖ¨ÂÖ±["imgdec"])=="function"?$.toString((imgdec)=>{
                                let imgDecrypt = imgdec;
                                return imgDecrypt();
                            },ÂÖ¨ÂÖ±["imgdec"]):ÂÖ¨ÂÖ±["imgdec"]:""
                        }
                    }
                })
            }

            d.push({
                title: "ÂàáÊç¢Á´ôÊ∫ê",
                url: $("#noLoading#").lazyRule((name,sgroup,stype) => {
                    updateItem("Julistloading2", { 
                        extra: {
                            id: "Julistloading",
                            lineVisible: false
                        } 
                    });
                    if(getMyVar('SrcJu_sousuoTest')){
                        return "toast://ÁºñËæëÊµãËØïÊ®°Âºè‰∏ã‰∏çÂÖÅËÆ∏Êç¢Ê∫ê.";
                    }else if(getMyVar('SrcJu_searchMode')=="sousuo"){
                        return "toast://ÊêúÁ¥¢Á∫øÁ®ãËøòÊú™ÁªìÊùüÔºåÁ®çÁ≠â...";
                    }else{
                        clearMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id');
                        require(config.‰æùËµñ);
                        deleteItemByCls('Juloadlist');
                        showLoading('ÊêúÊ∫ê‰∏≠,ËØ∑Á®çÂêé.');
                        search(name,"erji",false,sgroup,stype);
                        hideLoading();
                        return  "hiker://empty";
                    }
                }, sskeyword, sgroup||"" ,stype),
                pic_url: 'https://hikerfans.com/tubiao/messy/20.svg',
                col_type: 'icon_small_3',
                extra: {
                    cls: "Juloadlist",
                    newWindow: true,
                    windowId: MY_RULE.title + "ÊêúÁ¥¢È°µ",
                    longClick: [{
                        title: "Êñ∞ÊêúÁ¥¢È°µ",
                        js: $.toString((sskeyword) => {
                            return $("hiker://empty#noRecordHistory##noHistory##fullTheme###fypage").rule((sskeyword) => {
                                require(config.‰æùËµñ);
                                newsousuopage(sskeyword);
                            },sskeyword)
                        },sskeyword)
                    },{
                        title: "Á≤æÂáÜÂåπÈÖçÔºö"+(getItem('searchMatch','1')=="1"?"ÊòØ":"Âê¶"),
                        js: $.toString(() => {
                            let sm;
                            if(getItem('searchMatch','1')=="1"){
                                setItem('searchMatch','2');
                                sm = "ÂèñÊ∂àÊç¢Ê∫êÊêúÁ¥¢Á≤æÂáÜÂåπÈÖçÂêçÁß∞";
                            }else{
                                clearItem('searchMatch');
                                sm = "Êç¢Ê∫êÊêúÁ¥¢Á≤æÂáÜÂåπÈÖçÂêçÁß∞";
                            }
                            refreshPage(false);
                            return "toast://"+sm;
                        })
                    }]
                }
            })
            d.push({
                col_type: "line_blank"
            });
            let line_col_type = getItem('SrcJuLine_col_type', 'scroll_button');
            let addmoreitems = 0;
            if(getItem('extenditems','1')=="1" && details.moreitems && $.type(details.moreitems)=='array'){
                let moreitems = details.moreitems;
                if(moreitems.length>0){
                    moreitems.forEach(item => {
                        if(item.url!=surl){
                            item = toerji(item,{type:stype,name:sname});
                            item.extra = item.extra || {};
                            item.extra['back'] = 1;
                            item.extra['cls'] = "Juloadlist extendlist";
                            d.push(item);
                            addmoreitems = 1;
                        }
                    })
                }
            }
            if (line_col_type == 'scroll_button' && addmoreitems == 0) {
                for (let i = 0; i < 10; i++) {
                    d.push({
                        col_type: "blank_block"
                    })
                }
            }

            d.push({
                title: getMyVar(sname + 'sort') == '1' ? `‚Äú‚Äú‚Äù‚Äù<b><span style="color: #66CCEE">ÊéíÂ∫è‚áÖ</span></b>` : `‚Äú‚Äú‚Äù‚Äù<b><span style="color: #55AA44">ÊéíÂ∫è‚áÖ</span></b>`,
                url: $("#noLoading#").lazyRule((sname) => {
                    let ÂàóË°® = findItemsByCls('playlist') || [];
                    if(ÂàóË°®.length==0){
                        return 'toast://Êú™Ëé∑ÂèñÂà∞ÂàóË°®'
                    }
                    deleteItemByCls('playlist');
                    if (getMyVar(sname + 'sort') == '1') {
                        putMyVar(sname + 'sort', '0');
                        updateItem('listsort', {
                            title: `‚Äú‚Äú‚Äù‚Äù<b><span style="color: #55AA44">ÊéíÂ∫è‚áÖ</span></b>`
                        });
                    } else {
                        putMyVar(sname + 'sort', '1')
                        updateItem('listsort', {
                            title: `‚Äú‚Äú‚Äù‚Äù<b><span style="color: #66CCEE">ÊéíÂ∫è‚áÖ</span></b>`
                        });
                    };
                    ÂàóË°®.reverse();
                    ÂàóË°®.forEach(item => {
                        item.col_type = item.type;
                    })
                    
                    addItemBefore(getMyVar('‰∫åÁ∫ßÂä†ËΩΩÊâ©Â±ïÂàóË°®')?"extendlist":getMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id')?"Julistloading2":"Julistloading", ÂàóË°®);//ÊéíÂ∫èÂíåÊ†∑ÂºèÂä®ÊÄÅÂ§ÑÁêÜÊèíÂÖ•ÂàóË°®Êó∂Êü•Êâæid
                    return 'toast://ÂàáÊç¢ÊéíÂ∫èÊàêÂäü'
                }, sname),
                col_type: line_col_type,
                extra: {
                    id: "listsort",
                    cls: "Juloadlist"
                }
            })
            let reviseLiTitle = getItem('reviseLiTitle','0');
            d.push({
                title: `‚Äú‚Äú‚Äù‚Äù<b><span style="color: #f47983">Ê†∑Âºè<small>üé®</small></span></b>`,
                url: $(["text_1","text_2","text_3","text_4","flex_button","text_2_left","text_3_left","ÂàÜÈ°µËÆæÁΩÆ"],2,"ÈÄâÈõÜÂàóË°®Ê†∑Âºè").select(() => {
                    if(input=="ÂàÜÈ°µËÆæÁΩÆ"){
                        return $(["ÂºÄÂêØÂàÜÈ°µ","ÂÖ≥Èó≠ÂàÜÈ°µ","ÊØèÈ°µÊï∞Èáè","ÂàÜÈ°µÈòÄÂÄº"],2).select(() => {
                            let partpage = storage0.getItem('partpage') || {};
                            if(input=="ÂºÄÂêØÂàÜÈ°µ"){
                                partpage.ispage = 1;
                                storage0.setItem('partpage',partpage);
                            }else if(input=="ÂÖ≥Èó≠ÂàÜÈ°µ"){
                                partpage.ispage = 0;
                                storage0.setItem('partpage',partpage);
                            }else if(input=="ÊØèÈ°µÊï∞Èáè"){
                                return $(partpage.pagenum||"40","ÊØèÈ°µÈÄâÈõÜÊï∞Èáè").input((partpage) => {
                                    partpage.pagenum = parseInt(input);
                                    storage0.setItem('partpage',partpage);
                                    refreshPage(false);
                                    return 'hiker://empty'
                                },partpage)
                            }else if(input=="ÂàÜÈ°µÈòÄÂÄº"){
                                return $(partpage.partnum||"100","ÈÄâÈõÜÊï∞ÈáèË∂ÖËøáÂ§öÂ∞ëÊâçÂàÜÈ°µ").input((partpage) => {
                                    partpage.partnum = parseInt(input);
                                    storage0.setItem('partpage',partpage);
                                    refreshPage(false);
                                    return 'hiker://empty'
                                },partpage)
                            }
                            refreshPage(false);
                            return 'hiker://empty'
                        })
                    }else{
                        let ÂàóË°® = findItemsByCls('playlist') || [];
                        if(ÂàóË°®.length==0){
                            return 'toast://Êú™Ëé∑ÂèñÂà∞ÂàóË°®'
                        }
                        deleteItemByCls('playlist');
                        let list_col_type = input;
                        ÂàóË°®.forEach(item => {
                            item.col_type = list_col_type.replace("_left","");
                            if(list_col_type.indexOf("_left")>-1){
                                item.extra.textAlign = 'left';
                            }else{
                                delete item.extra.textAlign;
                            }
                        })
                        addItemBefore(getMyVar('‰∫åÁ∫ßÂä†ËΩΩÊâ©Â±ïÂàóË°®')?"extendlist":getMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id')?"Julistloading2":"Julistloading", ÂàóË°®);
                        setItem('SrcJuList_col_type', input);
                        return 'hiker://empty'
                    }
                }),
                col_type: line_col_type,
                extra: {
                    cls: "Juloadlist",
                    longClick: [{
                        title: "‰øÆÊ≠£ÈÄâÈõÜÊ†áÈ¢òÔºö"+(reviseLiTitle=="1"?"ÊòØ":"Âê¶"),
                        js: $.toString(() => {
                            let sm;
                            if(getItem('reviseLiTitle','0')=="1"){
                                clearItem('reviseLiTitle');
                                sm = "ÂèñÊ∂à‰øÆÊ≠£ÈÄâÈõÜÊ†áÈ¢òÂêçÁß∞";
                            }else{
                                setItem('reviseLiTitle','1');
                                sm = "Áªü‰∏Ä‰øÆÊ≠£ÈÄâÈõÜÊ†áÈ¢òÂêçÁß∞";
                            }
                            refreshPage(false);
                            return "toast://"+sm;
                        })
                    },{
                        title: "ÊòæÁ§∫Êâ©Â±ïÈ°πÔºö"+(getItem('extenditems','1')=="1"?"ÊòØ":"Âê¶"),
                        js: $.toString(() => {
                            let sm;
                            if(getItem('extenditems','1')=="1"){
                                setItem('extenditems','0');
                                sm = "ÂèñÊ∂àÊòæÁ§∫‰∫åÁ∫ßÊâ©Â±ïÈ°π";
                            }else{
                                clearItem('extenditems');
                                sm = "ÊòæÁ§∫‰∫åÁ∫ßÊâ©Â±ïÈ°π";
                            }
                            refreshPage(false);
                            return "toast://"+sm;
                        })
                    },{
                        title: "Á∫øË∑ØÊ†∑ÂºèÔºö"+getItem('SrcJuLine_col_type', 'scroll_button'),
                        js: $.toString(() => {
                            let sm;
                            if(getItem('SrcJuLine_col_type', 'scroll_button')=="flex_button"){
                                clearItem('SrcJuLine_col_type');
                                sm = "Á∫øË∑ØÊ†∑ÂºèÂ∑≤ÂàáÊç¢‰∏∫scroll_button";
                            }else{
                                setItem('SrcJuLine_col_type','flex_button');
                                sm = "Á∫øË∑ØÊ†∑ÂºèÂ∑≤ÂàáÊç¢‰∏∫flex_button";
                            }
                            refreshPage(false);
                            return "toast://"+sm;
                        })
                    }]
                }
            })
            
            if(Á∫øË∑Øs.length>0 && Á∫øË∑Øs[0] !="Á∫øË∑Ø"){
                Á∫øË∑Øs.forEach((it,i)=>{
                    d.push({
                        title: lineid==i?`‚Äú‚Äú‚Äù‚Äù<b><span style="color: #04B45F">`+it+`</span></b>`:it,
                        url: $("#noLoading#").lazyRule((lineurl,nowid,newid) => {
                            if(nowid != newid){
                                putMyVar(lineurl, newid);
                                refreshPage(false);
                            }
                            return 'hiker://empty'
                        }, "SrcJu_"+surl+"_line", lineid, i),
                        col_type: line_col_type,
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                })
            }
            //ÂàÜÈ°µÂÆö‰πâ
            let partpage = storage0.getItem('partpage') || {};
            if(details.page && details.pageparse){//ÂéüÁΩëÁ´ôÊúâÂàÜÈ°µÔºå‰∏çÊâßË°åËá™ÂÆö‰πâÂàÜÈ°µ
                let ÂàÜÈ°µs = details.page
                let ÂàÜÈ°µÈìæÊé• = [];
                let ÂàÜÈ°µÂêç = [];
                ÂàÜÈ°µs.forEach((it,i)=>{
                    ÂàÜÈ°µÈìæÊé•.push($("#noLoading#").lazyRule((pageurl,nowid,newid) => {
                            if(nowid != newid){
                                putMyVar(pageurl, newid);
                                refreshPage(false);
                            }
                            return 'hiker://empty'
                        }, "SrcJu_"+surl+"_page", pageid, i)
                    )
                    ÂàÜÈ°µÂêç.push(pageid==i?'‚Äú‚Äú‚Äù‚Äù<span style="color: #87CEFA">'+it.title:it.title)
                })
                if(ÂàÜÈ°µÂêç.length>0){
                    d.push({
                        col_type: "blank_block",
                        extra: {
                            cls: "Juloadlist"
                        }
                    });
                        d.push({
                        title: pageid==0?"‚Ü™Ô∏èÂ∞æÈ°µ":"‚èÆÔ∏è‰∏äÈ°µ",
                        url: pageid==0?ÂàÜÈ°µÈìæÊé•[ÂàÜÈ°µÂêç.length-1]:ÂàÜÈ°µÈìæÊé•[pageid-1],
                        col_type: 'text_4',
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                    d.push({
                        title: ÂàÜÈ°µÂêç[pageid],
                        url: $(ÂàÜÈ°µÂêç, 2).select((ÂàÜÈ°µÂêç,ÂàÜÈ°µÈìæÊé•) => {
                            return ÂàÜÈ°µÈìæÊé•[ÂàÜÈ°µÂêç.indexOf(input)];
                        },ÂàÜÈ°µÂêç,ÂàÜÈ°µÈìæÊé•),
                        col_type: 'text_2',
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                    d.push({
                        title: pageid==ÂàÜÈ°µÂêç.length-1?"È¶ñÈ°µ‚Ü©Ô∏è":"‰∏ãÈ°µ‚è≠Ô∏è",
                        url: pageid==ÂàÜÈ°µÂêç.length-1?ÂàÜÈ°µÈìæÊé•[0]:ÂàÜÈ°µÈìæÊé•[pageid+1],
                        col_type: 'text_4',
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                }
            }else if(partpage.ispage){//ÂêØÁî®ÂàÜÈ°µ
                let ÊØèÈ°µÊï∞Èáè = partpage.pagenum || 40; // ÂàÜÈ°µÁöÑÊØèÈ°µÊï∞Èáè       
                let ÁøªÈ°µÈòÄÂÄº = partpage.partnum || 100; // ÂàÜÈ°µÁöÑÁøªÈ°µÈòÄÂÄºÔºåË∂ÖËøáÂ§öÂ∞ëÊâçÊòæÁ§∫ÁøªÈ°µ
                
                if (ÂàóË°®.length > ÁøªÈ°µÈòÄÂÄº) { 
                    let ÊúÄÂ§ßÈ°µÊï∞ = Math.ceil(ÂàóË°®.length / ÊØèÈ°µÊï∞Èáè);  
                    let ÂàÜÈ°µÈ°µÁ†Å = pageid + 1; //ÂΩìÂâçÈ°µÊï∞
                    if (ÂàÜÈ°µÈ°µÁ†Å > ÊúÄÂ§ßÈ°µÊï∞) { //Èò≤Ê≠¢ÂàáÊç¢Á∫øË∑ØÂØºËá¥È°µÊï∞Êï∞ÁªÑË∂äÁïå
                        ÂàÜÈ°µÈ°µÁ†Å = ÊúÄÂ§ßÈ°µÊï∞;
                    }
                    let ÂàÜÈ°µÈìæÊé• = [];
                    let ÂàÜÈ°µÂêç = [];
                    function getNewArray(array, subGroupLength) {
                        let index = 0;
                        let newArray = [];
                        while(index < array.length) {
                            newArray.push(array.slice(index, index += subGroupLength));
                        }
                        return newArray;
                    }
                    let ÂàÜÈ°µs = getNewArray(ÂàóË°®, ÊØèÈ°µÊï∞Èáè);//ÊåâÊØèÈ°µÊï∞ÊçÆÂàáÂâ≤ÊàêÂ∞èÊï∞ÁªÑ

                    ÂàÜÈ°µs.forEach((it,i)=>{
                        ÂàÜÈ°µÈìæÊé•.push($("#noLoading#").lazyRule((pageurl,nowid,newid) => {
                                if(nowid != newid){
                                    putMyVar(pageurl, newid);
                                    refreshPage(false);
                                }
                                return 'hiker://empty'
                            }, "SrcJu_"+surl+"_page", pageid, i)
                        )
                        let start = i * ÊØèÈ°µÊï∞Èáè + 1;
                        let end = i * ÊØèÈ°µÊï∞Èáè + it.length;
                        let title = start + ' - ' + end;
                        ÂàÜÈ°µÂêç.push(pageid==i?'‚Äú‚Äú‚Äù‚Äù<span style="color: #87CEFA">'+title:title)
                    })
                    d.push({
                        col_type: "blank_block",
                        extra: {
                            cls: "Juloadlist"
                        }
                    });
                    d.push({
                        title: ÂàÜÈ°µÈ°µÁ†Å==1?"‚Ü™Ô∏èÂ∞æÈ°µ":"‚èÆÔ∏è‰∏äÈ°µ",
                        url: ÂàÜÈ°µÈ°µÁ†Å==1?ÂàÜÈ°µÈìæÊé•[ÂàÜÈ°µÂêç.length-1]:ÂàÜÈ°µÈìæÊé•[pageid-1],
                        col_type: 'text_4',
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                    d.push({
                        title: ÂàÜÈ°µÂêç[pageid],
                        url: $(ÂàÜÈ°µÂêç, 2).select((ÂàÜÈ°µÂêç,ÂàÜÈ°µÈìæÊé•) => {
                            return ÂàÜÈ°µÈìæÊé•[ÂàÜÈ°µÂêç.indexOf(input)];
                        },ÂàÜÈ°µÂêç,ÂàÜÈ°µÈìæÊé•),
                        col_type: 'text_2',
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                    d.push({
                        title: ÂàÜÈ°µÈ°µÁ†Å==ÂàÜÈ°µÂêç.length?"È¶ñÈ°µ‚Ü©Ô∏è":"‰∏ãÈ°µ‚è≠Ô∏è",
                        url: ÂàÜÈ°µÈ°µÁ†Å==ÂàÜÈ°µÂêç.length?ÂàÜÈ°µÈìæÊé•[0]:ÂàÜÈ°µÈìæÊé•[pageid+1],
                        col_type: 'text_4',
                        extra: {
                            cls: "Juloadlist"
                        }
                    })
                    ÂàóË°® = ÂàÜÈ°µs[pageid];//ÂèñÂΩìÂâçÂàÜÈ°µÁöÑÈÄâÈõÜÂàóË°®
                }
            }

            let list_col_type = getItem('SrcJuList_col_type', 'text_2');//ÂàóË°®Ê†∑Âºè
            for(let i=0; i<ÂàóË°®.length; i++) {
                let extra = Object.assign({}, details["extra"] || {});//‰∫åÁ∫ßËøîÂõûÊï∞ÊçÆ‰∏≠ÁöÑextraËÆæ‰∏∫ÈªòËÆ§
                try{
                    extra = Object.assign(extra, ÂàóË°®[i].extra || {});//‰ºòÂÖàÁî®ÈÄâÈõÜÁöÑextra
                }catch(e){}
                extra.id = name + "_ÈÄâÈõÜ_" + (pageid?pageid+"_":"") + i;
                extra.cls = "Juloadlist playlist";
                if(stype=="Âê¨‰π¶"||stype=="ÂΩ±ËßÜ"){
                    extra.jsLoadingInject = true;
                    let blockRules = ['.m4a', '.mp3', '.gif', '.jpeg', '.jpg', '.ico', '.png', 'hm.baidu.com', '/ads/*.js', 'cnzz.com', '51.la'];
                    if(extra.blockRules && $.type(extra.blockRules)=="array"){
                        try{
                            blockRules = Object.assign(blockRules,extra.blockRules);
                        }catch(e){}
                    }
                    extra.blockRules = blockRules;
                }
                if(list_col_type.indexOf("_left")>-1){
                    extra.textAlign = 'left';
                }
                if (stype=="Â∞èËØ¥" || details["rule"] || details["novel"] || ÂàóË°®[i].rule) {
                    extra.url = ÂàóË°®[i].url;
                    lazy = lazy.replace("@lazyRule=.",((stype=="Â∞èËØ¥"||details["novel"])?"#readTheme##autoPage#":"#noRecordHistory#")+"@rule=").replace(`input.split("##")[1]`,`MY_PARAMS.url || ""`);
                }
                d.push({
                    title: reviseLiTitle=="1"?ÂàóË°®[i].title.replace(name,'').replace(/‚Äò|‚Äô|‚Äú|‚Äù|<[^>]+>| |-|_|Á¨¨|ÈõÜ|ËØù|Á´†|\</g,'').replace('Ôºà','(').replace('Ôºâ',')'):ÂàóË°®[i].title,
                    url: "hiker://empty##" + ÂàóË°®[i].url + lazy,
                    desc: ÂàóË°®[i].desc,
                    img: ÂàóË°®[i].img,
                    col_type: ÂàóË°®[i].col_type || list_col_type.replace("_left",""),
                    extra: extra
                });
            }
            
            if(ÂàóË°®.length>0 || getMyVar('SrcJu_sousuoTest')){
                isload = 1;
            }else if(ÂàóË°®.length==0){
                if(!getMyVar('Âä†ËΩΩÂºÇÂ∏∏Ëá™Âä®Êç¢Ê∫ê')){
                    putMyVar('Âä†ËΩΩÂºÇÂ∏∏Ëá™Âä®Êç¢Ê∫ê','1');
                    refreshPage(false);
                }else{
                    toast("ÈÄâÈõÜÂàóË°®‰∏∫Á©∫ÔºåËØ∑Êõ¥Êç¢ÂÖ∂‰ªñÊ∫ê");
                }
            }
        }
    } catch (e) {
        toast('ÊúâÂºÇÂ∏∏ÔºåÁúãÊó•Âøó');
        xlog('‚àö'+sname + '>Âä†ËΩΩËØ¶ÊÉÖÂ§±Ë¥•>' + e.message);
    }

    if (isload) {
        if(getItem('extenditems','1')=="1" && details.extenditems && $.type(details.extenditems)=='array'){
            let extenditems = details.extenditems;
            if(extenditems.length>0){
                d.push({
                    col_type: "blank_block",
                    extra: {
                        cls: "Juloadlist extendlist",
                        id: "extendlist"
                    }
                })
                extenditems.forEach(item => {
                    if(item.url!=surl){
                        item = toerji(item,{type:stype,name:sname});
                        item.extra = item.extra || {};
                        item.extra['back'] = 1;
                        item.extra['cls'] = "Juloadlist extendlist";
                        d.push(item)
                    }
                })
            }
            putMyVar('‰∫åÁ∫ßÂä†ËΩΩÊâ©Â±ïÂàóË°®','1');
        }
        d.push({
            title: "‚Äò‚Äò‚Äô‚Äô<small><font color=#f20c00>ÂΩìÂâçÊï∞ÊçÆÊ∫êÔºö" + sname + (sauthor?", ‰ΩúËÄÖÔºö" + sauthor:"") + "</font></small>",
            url: 'hiker://empty',
            col_type: 'text_center_1',
            extra: {
                id: getMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id')?"Julistloading2":"Julistloading",
                lineVisible: false
            }
        });
        setResult(d);
        if(!getMyVar(sname+"_"+name)){
            toast('ÂΩìÂâçÊï∞ÊçÆÊ∫êÔºö' + sname + (sauthor?", ‰ΩúËÄÖÔºö" + sauthor:""));
        }
        putMyVar(sname+"_"+name, "1");
        //Êõ¥Êç¢Êî∂ËóèÂ∞ÅÈù¢
        if(erjidetails.img && oldMY_PARAMS.img!=erjidetails.img){
            setPagePicUrl(erjidetails.img);
        }
        //‰∫åÁ∫ßËØ¶ÊÉÖÁÆÄ‰ªã‰∏¥Êó∂‰ø°ÊÅØ
        storage0.putMyVar('‰∫åÁ∫ßËØ¶ÊÉÖ‰∏¥Êó∂ÂØπË±°',erjidetails);
        //‰∫åÁ∫ßÊ∫êÊµèËßàËÆ∞ÂΩï‰øùÂ≠ò
        let erjidata = { name: name, sname: sname, surl: surl, stype: stype, lineid: lineid, pageid: pageid };
        setMark(erjidata);
        //ÂΩìÂâç‰∫åÁ∫ßËØ¶ÊÉÖÊï∞ÊçÆ‰øùÂ≠ò
        if(!getMyVar("SrcJu_Ë∞ÉËØïÊ®°Âºè")){
            details.sname = sname;
            details.surl = surl;
            details.pageid = pageid;
            writeFile(detailsfile, $.stringify(details));
        }
        //Êî∂ËóèÊõ¥Êñ∞ÊúÄÊñ∞Á´†ËäÇ
        if (parse['ÊúÄÊñ∞']) {
            setLastChapterRule('js:' + $.toString((sname,surl,ÊúÄÊñ∞,ÂÖ¨ÂÖ±,ÂèÇÊï∞) => {
                let ÊúÄÊñ∞str = ÊúÄÊñ∞.toString().replace('setResult','return ').replace('getResCode()','request(surl)');
                eval("let ÊúÄÊñ∞2 = " + ÊúÄÊñ∞str);
                let Ê†áËØÜ = ÂèÇÊï∞.Ê†áËØÜ;
                try{
                    let zx = ÊúÄÊñ∞2(surl,ÂÖ¨ÂÖ±) || "";
                    setResult(sname + " | " + (zx||""));
                }catch(e){
                    ÊúÄÊñ∞2(surl,ÂÖ¨ÂÖ±);
                }
            }, sname, surl, parse['ÊúÄÊñ∞'], ÂÖ¨ÂÖ±, {"ËßÑÂàôÂêç": MY_RULE._title || MY_RULE.title, "Ê†áËØÜ": Ê†áËØÜ}))
        }
        //ÂàáÊç¢Ê∫êÊó∂Êõ¥Êñ∞Êî∂ËóèÊï∞ÊçÆÔºå‰ª•ÂèäÂàÜ‰∫´Êó∂ÈôÑÂ∏¶Êé•Âè£
        if (typeof (setPageParams) != "undefined") {
            if ((surl && oldMY_PARAMS.surl!=surl) || !oldMY_PARAMS.sourcedata) {
                delete sourcedata2['parse']
                erjiextra.name = erjiextra.name || name;
                erjiextra.sourcedata = sourcedata2;
                delete erjiextra.sousuo;//Ê≠£Â∏∏Âä†ËΩΩÁöÑÊ∏ÖÈô§ËøîÂõûÊêúÁ¥¢Ê†áËØÜÔºåÁî®‰∫é‰∏ãÊ¨°Âä†ËΩΩÂºÇÂ∏∏Êó∂Ëá™Âä®ÊêúÊ∫ê
                setPageParams(erjiextra);
            }
        }
        putMyVar('ÊòØÂê¶ÂèñÁºìÂ≠òÊñá‰ª∂','1');//Âà§Êñ≠ÊòØÂê¶ÂèñÊú¨Âú∞ÁºìÂ≠òÊñá‰ª∂,ËΩØ‰ª∂ÊâìÂºÄÂàùÊ¨°Âú®Á∫øÂèñ
    } else {
        if(!detailload){
            pic = MY_PARAMS.img || "";
            pic = pic&&pic.indexOf("@Referer=") == -1 ? pic + "@Referer=" : pic;
            d.push({
                title: "\nÊêúÁ¥¢Êé•Âè£Ê∫êÁªìÊûúÂ¶Ç‰∏ã",
                desc: "\n\nÈÄâÊã©‰∏Ä‰∏™Ê∫êËßÇÁúãÂêßüëá",
                pic_url: pic,
                url: pic,
                col_type: 'movie_1_vertical_pic_blur',
                extra: {
                    gradient: true,
                    id: "detailid"
                }
            });
        }
        d.push({
            title: "",
            url: 'hiker://empty',
            col_type: 'text_center_1',
            extra: {
                id: "Julistloading",
                lineVisible: false
            }
        });
        setResult(d);
        
        if(!getMyVar('SrcJu_sousuoTest') && !getMyVar("SrcJu_Ë∞ÉËØïÊ®°Âºè") && !oldMY_PARAMS.sousuo){
            if(getMyVar('Âä†ËΩΩÂºÇÂ∏∏Ëá™Âä®Êç¢Ê∫ê')=="1"){
                showLoading('ÊêúÊ∫ê‰∏≠,ËØ∑Á®çÂêé.');
                search(name,"erji",false,sgroup,stype);
            }else{
                toast('‰∏ãÊãâÂà∑Êñ∞ÁúãÁúã');
            }
        }
    }
    clearMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id');
}
//ÊêúÁ¥¢È°µÈù¢
function sousuo() {
    let name = MY_URL.split('##')[1];
    
    if(getItem('searchmode')!="jusousuo"){
        let d = [];
        d.push({
            title: "ÊêúÁ¥¢‰∏≠...",
            url: "hiker://empty",
            extra: {
                id: "sousuoloading"
            }
        });
        setResult(d);
        let info = storage0.getMyVar('‰∏ÄÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ') || {};
        search(name,'sousuo',false,info.group);
    }else{
        setResult([{
            title: "ËßÜÁïåËÅöÊêú",
            url: "hiker://search?s=" + name.split('  ')[0].trim(),
            extra: {
                delegateOnlySearch: true,
                rules: $.toString((name) => {
                    let info = storage0.getMyVar('‰∏ÄÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ') || {};
                    require(config.‰æùËµñ);
                    let ssdatalist = erdatalist.filter(it=>{
                        if(info.group=="ÂÖ®ÂÖ®" || !info.group){
                            return it.type==info.type;
                        }else{
                            return it.type==info.type && (it.group==info.group||it.group=="ÂÖ®ÂÖ®");
                        }
                    });
                    let keyword = name.split('  ')[0].trim();
                    let keyword2;
                    if(name.indexOf('  ')>-1){
                        keyword2 = name.split('  ')[1].trim() || info.name;
                    }

                    if(keyword2){
                        ssdatalist = ssdatalist.filter(it=>{
                            return it.type==info.type && it.name==keyword2;
                        });
                    }

                    let data = [];
                    ssdatalist.forEach(it=>{
                        data.push({
                            "title": it.name,
                            "search_url": "hiker://empty##fypage",
                            "searchFind": `js: require(config.‰æùËµñ); let d = search('` + keyword + `','jusousuo',` + JSON.stringify(it) + `); setResult(d);`
                        });
                    })
                    return JSON.stringify(data)
                },name)
            }
        }])
    }
}
//ÊêúÁ¥¢Êé•Âè£
function search(keyword, mode, sdata, group, type) {
    //mode:sousuo(ËÅöÈòÖËÅöÂêà)„ÄÅsousuotest(Êé•Âè£ÊµãËØï)„ÄÅerji(‰∫åÁ∫ßÊç¢Ê∫ê)„ÄÅsousuopage(ÂóÖËßâÊñ∞ÊêúÁ¥¢È°µ)„ÄÅjusousuo(ËßÜÁïåËÅöÂêà)
    let updateItemid = mode=="sousuo" ?  "sousuoloading" : mode=="sousuopage"?"sousuoloading"+getMyVar('SrcJu_sousuoType',type||''):"Julistloading";
    if((mode=="sousuo") && getMyVar('SrcJu_searching')=="1"){
        if(MY_PAGE==1){
            putMyVar("SrcJu_ÂÅúÊ≠¢ÊêúÁ¥¢Á∫øÁ®ã", "1");
            let waittime = 10;
            for (let i = 0; i < waittime; i++) {
                if(getMyVar("SrcJu_ÂÅúÊ≠¢ÊêúÁ¥¢Á∫øÁ®ã","0")=="0"){
                    updateItem(updateItemid, { title: 'ÊêúÁ¥¢‰∏≠...' });
                    break;
                }
                updateItem(updateItemid, { title: 'Á≠âÂæÖ‰∏äÊ¨°Á∫øÁ®ãÁªìÊùüÔºå'+(waittime-i-1)+'s' });
                java.lang.Thread.sleep(1000);
            }
        }
    }
    let name = keyword.split('  ')[0].trim();
    let searchMark = storage0.getMyVar('SrcJu_searchMark') || {};//‰∫åÁ∫ßÊç¢Ê∫êÁºìÂ≠ò
    if(mode=="erji" && searchMark[name]){
        addItemBefore(updateItemid, searchMark[name]);
        updateItem(updateItemid, {
            title: getMyVar('SrcJu_searching')=="1"?"‚Äò‚Äò‚Äô‚Äô<small>ÊêúÁ¥¢‰∏≠</small>":"‚Äò‚Äò‚Äô‚Äô<small>ÂΩìÂâçÊêúÁ¥¢‰∏∫ÁºìÂ≠ò</small>",
            url: $("Á°ÆÂÆöÂà†Èô§‚Äú"+name+"‚ÄùÊêúÁ¥¢ÁºìÂ≠òÂêóÔºü").confirm((name)=>{
                let searchMark = storage0.getMyVar('SrcJu_searchMark') || {};
                delete searchMark[name];
                storage0.putMyVar('SrcJu_searchMark', searchMark);
                refreshPage(true);
                return "toast://Â∑≤Ê∏ÖÈô§";
            },name)
        });
        let i = 0;
        let one = "";
        for (var k in searchMark) {
            i++;
            if (i == 1) { one = k }
        }
        if (i > 20) { delete searchMark[one]; }
        hideLoading();
        return "hiker://empty";
    }else{
        updateItem(updateItemid, {
            title: mode=="erji"?"ÊêúÊ∫ê‰∏≠...":"ÊêúÁ¥¢‰∏≠...",
            url: "hiker://empty",
        });
    }
    if(mode!="jusousuo" && mode!="sousuopage" && getMyVar('SrcJu_searching')=="1"){
        toast("‰∏äÊ¨°ÊêúÁ¥¢Á∫øÁ®ãËøòÊú™ÁªìÊùüÔºåÁ≠âÁ≠âÂÜçÊù•");
        if(mode=="sousuotest"){
            return [];
        }else{
            return "hiker://empty";
        }
    }

    let page = 1;
    if(mode=="sousuo"){
        if(MY_PAGE==1){
            clearMyVar('MY_PGAE');
        }else{
            page = parseInt(getMyVar('MY_PGAE','1'))+1;
            putMyVar('MY_PGAE',page);
        }
    }else if(mode=="sousuotest" || mode=="sousuopage" || mode=="jusousuo"){
        page = MY_PAGE;
    }
    if(page==1){
        clearMyVar('nosousuolist');
    }

    let ssstype = type || runMode;
    let sssname;

    if(keyword.indexOf('  ')>-1){
        let keyword2 = keyword.split('  ')[1].trim();
        if(keyword2 && getTypeNames().indexOf(keyword2)>-1){
            ssstype = keyword2;
        }else{
            sssname = keyword2 || sourcename;
        }
    }

    putMyVar('SrcJu_searchMode',mode);
    putMyVar('SrcJu_searching','1');
    let success = 0;
    let results = [];
    let ssdatalist = [];
    if (sdata) {
        ssdatalist.push(sdata);
    }else if (sssname){
        ssdatalist = getListData("er", ssstype).filter(it=>{
            return it.name==sssname;
        });
    }else{
        ssdatalist = erdatalist.filter(it=>{
            if(group=="ÂÖ®ÂÖ®" || !group){//Êú™ÂàÜÁªÑÊàñÂΩìÂâç‰∏∫ÂÖ®ÂÖ®ÂàÜÁªÑÁöÑÊé•Âè£Êó∂ÔºåÊêúÁ¥¢ÊâÄÊúâÊ≠§Á±ªÂûãÁöÑÊé•Âè£
                return it.type==ssstype;
            }else{
                return it.type==ssstype && (it.group==group||it.group=="ÂÖ®ÂÖ®");//ÂàÜÁªÑÂêç‰∏∫ÁúüÂàôÂè™ÊêúÊåáÂÆöÂàÜÁªÑÂíåÂÖ®ÂÖ®
            }
        });
    }
    let nosousuolist = storage0.getMyVar('nosousuolist') || [];
    if (nosousuolist.length>0){
        ssdatalist = ssdatalist.filter(it => {
            return nosousuolist.indexOf(it.name) == -1;
        })
    }
    
    let task = function (obj) {
        let objdata = obj.data;
        let objmode = obj.mode;
        let name = obj.name;

        try {
            let parse;
            let ÂÖ¨ÂÖ±;
            let Ê†áËØÜ;
            eval("let source = " + objdata.erparse);
            if (source.ext && /^http/.test(source.ext)) {
                requireCache(source.ext, 48);
                parse = erdata;
            } else {
                parse = source;
            }
            if(parse){
                try{
                    require(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + 'SrcJuMethod.js');
                    cacheData(objdata);
                }catch(e){
                    //xlog("‚àöÁºìÂ≠ò‰∏¥Êó∂Êñá‰ª∂Â§±Ë¥•>"+e.message);
                }
                eval("let gonggong = " + objdata.public);
                if (gonggong && gonggong.ext && /^http/.test(gonggong.ext)) {
                    requireCache(gonggong.ext, 48);
                    gonggong = ggdata;
                }
                ÂÖ¨ÂÖ± = gonggong || parse['ÂÖ¨ÂÖ±'] || {};
                if(ÂÖ¨ÂÖ±['È¢ÑÂ§ÑÁêÜ']){
                    try{
                        ÂÖ¨ÂÖ±['È¢ÑÂ§ÑÁêÜ']();
                    }catch(e){
                        xlog('‚àöÊâßË°åÈ¢ÑÂ§ÑÁêÜÊä•ÈîôÔºå‰ø°ÊÅØ>'+e.message);
                    }
                }
                Ê†áËØÜ = objdata.type + "_" + objdata.name;
                let ssdata = [];
                let ÊêúÁ¥¢str = parse['ÊêúÁ¥¢'].toString();
                if(!ÊêúÁ¥¢str.includes('rule')){
                    ÊêúÁ¥¢str = ÊêúÁ¥¢str.replace('setResult','return ');
                }
                eval("let ÊêúÁ¥¢ = " + ÊêúÁ¥¢str)
                let ÂèÇÊï∞ = {"ËßÑÂàôÂêç": MY_RULE._title || MY_RULE.title, "Ê†áËØÜ": Ê†áËØÜ}
                function ocr(codeurl,headers) {
                    headers= headers || {};
                    let img = convertBase64Image(codeurl,headers).replace('data:image/jpeg;base64,','');
                    let code = request('https://api-cf.nn.ci/ocr/b64/text', { body: img, method: 'POST', headers: {"Content-Type":"text/html"}});
                    code = code.replace(/o/g, '0').replace(/u/g, '0').replace(/I/g, '1').replace(/l/g, '1').replace(/g/g, '9');
                    if(code.includes("+")&&code.includes("=")){
                        code = eval(code.split("=")[0]);
                    }
                    xlog('ËØÜÂà´È™åËØÅÁ†ÅÔºö'+code);
                    return code;
                }
                ssdata = ÊêúÁ¥¢(name,page,ÂÖ¨ÂÖ±,ÂèÇÊï∞) || [];
                //xlog('‚àö'+objdata.name+">ÊêúÁ¥¢ÁªìÊûú>"+ssdata.length);
                let resultdata = [];
                ssdata.forEach(item => {
                    let extra = item.extra || {};
                    extra.name = extra.name || extra.pageTitle || (item.title?item.title.replace(/‚Äò|‚Äô|‚Äú|‚Äù|<[^>]+>|ÂÖ®ÈõÜ|ÂõΩËØ≠|Á≤§ËØ≠/g,"").trim():"");
                    if((objmode=="erji" && ((getItem('searchMatch','1')=="1"&&extra.name.toLowerCase()==name.toLowerCase())||(getItem('searchMatch')=="2"&&extra.name.toLowerCase().includes(name.toLowerCase())))) || objmode!="erji"){
                        let keepurl = /js:|select:|\(|\)|=>|hiker:\/\/page|toast:/;//ÂÆö‰πâ‰øùÁïô‰º†ÂÄºÁöÑÈ°πÁõÆurl
                        //if((!keepurl.test(item.url) && extra.name.toLowerCase().includes(name.toLowerCase())) || keepurl.test(item.url) || objmode!="erji"){
                            extra.img = extra.img || item.img || item.pic_url;
                            extra.stype = objdata.type;
                            extra.sname = objdata.name;
                            extra.pageTitle = extra.pageTitle || extra.name;
                            extra.surl = item.url && !keepurl.test(item.url) ? item.url.replace(/hiker:\/\/empty|#immersiveTheme#|#autoCache#|#noRecordHistory#|#noHistory#|#readTheme#|#autoPage#|#noLoading#|#/g, "") : "";
                            if(/sousuo/.test(objmode)){
                                extra.sousuo = 1;
                            }
                            item.extra = extra;
                            item.url = /sousuo/.test(objmode) ? (keepurl.test(item.url) || item.url=='hiker://empty')?item.url:$("hiker://empty?type="+objdata.type+"#immersiveTheme##autoCache#").rule(() => {
                                require(config.‰æùËµñ);
                                erji();
                            }) : "hiker://empty##"+ item.url + $("#noLoading#").b64().lazyRule((extra) => {
                                if(getMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id')){
                                    return "toast://ËØ∑ÂãøÈáçÂ§çÁÇπÂáªÔºåÁ®çÁ≠â...";
                                }else{
                                    putMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id','1');
                                    clearMyVar(extra.sname+"_"+extra.name);
                                    storage0.putMyVar('‰∫åÁ∫ßÈôÑÂä†‰∏¥Êó∂ÂØπË±°', extra);
                                    refreshPage(false);
                                    return "toast://Â∑≤ÂàáÊç¢Ê∫êÔºö" + extra.sname;
                                }
                            }, extra);
                            item.title = objmode=="erji"?objdata.name:item.title;
                            //item.content = item.content || item.desc;
                            item.desc = item.desc || "";
                            item.desc = objmode=="sousuo"||objmode=="sousuopage"  ? MY_RULE.title+' ¬∑ '+objdata.name+' ¬∑ '+item.desc :objmode=="sousuotest"?(item.content || item.desc): (extra.desc || item.desc);
                            item.col_type = objmode=="sousuo"||objmode=="jusousuo"  ? "video" : (objmode=="sousuotest"||objmode=="sousuopage") ? "movie_1_vertical_pic" : "avatar";
                            //log(item);
                            resultdata.push(item);
                        //}
                    }
                })
                return {result:resultdata, success:1};
            }
            return {result:[], success:0};
        } catch (e) {
            xlog('‚àö'+objdata.name + '>ÊêúÁ¥¢Â§±Ë¥•>' + e.message);
            return {result:[], success:0};
        }
    }
    let list = ssdatalist.map((item) => {
        return {
            func: task,
            param: {"data":item,"mode":mode,"name":name},
            id: item.name
        }
    });
    if (list.length > 0) {
        be(list, {
            func: function (obj, id, error, taskResult) {
                if(getMyVar("SrcJu_ÂÅúÊ≠¢ÊêúÁ¥¢Á∫øÁ®ã")=="1"){
                    return "break";
                }else if(taskResult.success==1){
                    let data = taskResult.result;
                    if(data.length>0){
                        success++;
                        if(mode=="erji"){
                            let searchMark = storage0.getMyVar('SrcJu_searchMark') || {};//‰∫åÁ∫ßÊç¢Ê∫êÁºìÂ≠ò
                            searchMark[name] = searchMark[name] || [];
                            searchMark[name] = searchMark[name].concat(data);
                            storage0.putMyVar('SrcJu_searchMark', searchMark);
                            if(!getMyVar('Êç¢Ê∫êÂèòÊõ¥ÂàóË°®id')){
                                addItemBefore("Julistloading", data);
                            }
                            hideLoading();
                        }else if(mode=="sousuo"){
                            addItemBefore(updateItemid, data);
                        }else if(mode=="sousuopage"){
                            addItemBefore(updateItemid, data);
                        }else if(mode=="sousuotest"||mode=="jusousuo"){
                            results = data;
                        }
                    }else{
                        nosousuolist.push(id);
                        storage0.putMyVar('nosousuolist', nosousuolist);
                    }
                }
            },
            param: {
            }
        });
        /*
        if (mode=="erji") {
            storage0.putMyVar('searchMark', searchMark);
        }
        */
        clearMyVar('SrcJu_searching');
        clearMyVar('SrcJu_searchMode');
        hideLoading();
        clearMyVar("SrcJu_ÂÅúÊ≠¢ÊêúÁ¥¢Á∫øÁ®ã");
        if(mode=="sousuotest"||mode=="jusousuo"){
            return results;
        }else{
            let sousuosm = mode=="sousuo"||mode=="sousuopage" ? success + "/" + list.length + "ÔºåÁ¨¨"+page+"È°µÊêúÁ¥¢ÂÆåÊàê" : "‚Äò‚Äò‚Äô‚Äô<small><font color=#f13b66a>" + success + "</font>/" + list.length + "ÔºåÊêúÁ¥¢ÂÆåÊàê</small>";
            updateItem(updateItemid, { title: sousuosm });
        }
    } else {
        clearMyVar('SrcJu_searching');
        clearMyVar('SrcJu_searchMode');
        hideLoading();
        clearMyVar("SrcJu_ÂÅúÊ≠¢ÊêúÁ¥¢Á∫øÁ®ã");
        if(page==1){
            toast("Êó†Êé•Âè£");
            if(mode=="sousuo"||mode=="sousuopage"){
                updateItem("sousuoloading", { title: "Êó†Êé•Âè£" });
            }
        }
        if(mode=="sousuotest"||mode=="jusousuo"){
            return [];
        }
    }
}

//ÂèñÊú¨Âú∞Ë∂≥ËøπËÆ∞ÂΩï
function getMark(name, stype) {
    let markfile = "hiker://files/rules/Src/Ju/mark.json";
    let markdata = fetch(markfile);
    if (markdata != "") {
        eval("var marklist=" + markdata + ";");
    } else {
        var marklist = [];
    }
    let mark = marklist.filter(it => {
        return it.name == name && it.stype == stype;
    })
    if (mark.length > 0) {
        return mark[0];
    } else {
        return {};
    }
}
//‰øùÂ≠òÊú¨Âú∞Ë∂≥ËøπËÆ∞ÂΩï
function setMark(data) {
    let markfile = "hiker://files/rules/Src/Ju/mark.json";
    let markdata = fetch(markfile);
    if (markdata != "") {
        eval("var marklist=" + markdata + ";");
    } else {
        var marklist = [];
    }
    let mark = marklist.filter(it => {
        return it.name == data.name && it.stype == data.stype;
    })
    if (mark.length > 0) {
        let index = marklist.indexOf(mark[0]);
        marklist.splice(index, 1)
    }
    marklist.push(data);
    if (marklist.length > 100) {
        marklist.splice(0, 1);
    }
    writeFile(markfile, JSON.stringify(marklist));
    return 1;
}
//ÂõæÊ†á‰∏ãËΩΩ
function downloadicon() {
    try {
        if (!fileExist('hiker://files/cache/src/ÁÆ°ÁêÜ.svg')) {
            downloadFile('https://hikerfans.com/tubiao/messy/13.svg', 'hiker://files/cache/src/ÁÆ°ÁêÜ.svg');
        }
        if (!fileExist('hiker://files/cache/src/Êõ¥Êñ∞.webp')) {
            downloadFile(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + "img/Êõ¥Êñ∞.webp", 'hiker://files/cache/src/Êõ¥Êñ∞.webp');
        }
        if (!fileExist('hiker://files/cache/src/ÂàÜÁ±ª.webp')) {
            downloadFile(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + "img/ÂàÜÁ±ª.webp", 'hiker://files/cache/src/ÂàÜÁ±ª.webp');
        }
        if (!fileExist('hiker://files/cache/src/ÊéíË°å.webp')) {
            downloadFile(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0] + "img/ÊéíË°å.webp", 'hiker://files/cache/src/ÊéíË°å.webp');
        }
        if (!fileExist('hiker://files/cache/src/Êî∂Ëóè.svg')) {
            downloadFile('https://hikerfans.com/tubiao/messy/165.svg', 'hiker://files/cache/src/Êî∂Ëóè.svg');
        }
    } catch (e) { }
}

//ÁâàÊú¨Ê£ÄÊµã
function Version() {
    var nowVersion = getItem('Version', "0.1");//Áé∞Âú®ÁâàÊú¨ 
    var nowtime = Date.now();
    var oldtime = parseInt(getItem('VersionChecktime', '0').replace('time', ''));
    if (getMyVar('SrcJu_versionCheck', '0') == '0' && nowtime > (oldtime + 12 * 60 * 60 * 1000)) {
        try {
            eval(request(config.‰æùËµñ.match(/http(s)?:\/\/.*\//)[0].replace('/Ju/', '/master/') + 'SrcTmplVersion.js'))
            if (parseFloat(newVersion.SrcJu) > parseFloat(nowVersion)) {
                confirm({
                    title: 'ÂèëÁé∞Êñ∞ÁâàÊú¨ÔºåÊòØÂê¶Êõ¥Êñ∞Ôºü',
                    content: nowVersion + '=>' + newVersion.SrcJu + '\n' + newVersion.SrcJudesc[newVersion.SrcJu],
                    confirm: $.toString((nowtime,newVersion) => {
                        setItem('Version', newVersion);
                        setItem('VersionChecktime', nowtime + 'time');
                        deleteCache();
                        delete config.‰æùËµñ;
                        refreshPage();
                    }, nowtime, newVersion.SrcJu),
                    cancel: ''
                })
                xlog('‚àöÊ£ÄÊµãÂà∞Êñ∞ÁâàÊú¨ÔºÅ\nV' + newVersion.SrcJu + 'ÁâàÊú¨„Äã' + newVersion.SrcJudesc[newVersion.SrcJu]);
            }
            putMyVar('SrcJu_Version', '-V' + newVersion.SrcJu);
        } catch (e) { }
        putMyVar('SrcJu_versionCheck', '1');
    } else {
        putMyVar('SrcJu_Version', '-V' + nowVersion);
    }
}
//Êñ∞ÊêúÁ¥¢È°µ
function newsousuopage(keyword,searchtype,relyfile) {
    addListener("onClose", $.toString(() => {
        if(getMyVar('SrcJu_rely')){
            initConfig({
                ‰æùËµñ: getMyVar('SrcJu_rely')
            });
            clearMyVar('SrcJu_rely');
        }
        clearMyVar('SrcJu_sousuoName');
        clearMyVar('SrcJu_sousuoType');
        putMyVar("SrcJu_ÂÅúÊ≠¢ÊêúÁ¥¢Á∫øÁ®ã", "1");
    }));
    addListener('onRefresh', $.toString(() => {
        clearMyVar('SrcJu_sousuoName');
    }));
    setPageTitle("ÊêúÁ¥¢|ËÅöÈòÖ‚àö");
    if(relyfile){
        if(!getMyVar('SrcJu_rely') && config.‰æùËµñ){
            putMyVar('SrcJu_rely',config.‰æùËµñ);
        }
        initConfig({
            ‰æùËµñ: relyfile
        });
    }
    let name = getMyVar('SrcJu_sousuoName',keyword||'');
    let d = [];
    let descarr = ['ÂèØÂø´ÈÄüÂàáÊç¢‰∏ãÈù¢Á±ªÂûã','ÂÖ≥ÈîÆÂ≠ó+2‰∏™Á©∫Ê†ºÔºåÊêúÂΩìÂâç','ÂÖ≥ÈîÆÂ≠ó+2‰∏™Á©∫Ê†º+Êé•Âè£Âêç','ÂàáÊç¢Á´ôÊ∫êÈïøÊåâÂèØËøõÂÖ•ËøôÈáå','Êé•Âè£ÊúâÂàÜÁªÑÔºåÂàôÊêúÁ¥¢ÂêåÂàÜÁªÑ'];
    if(MY_PAGE==1){
        d.push({
            title: "üîç",
            url: $.toString(() => {
                if(input){
                    putMyVar('SrcJu_sousuoName',input);
                    if(input){
                        let recordlist = storage0.getItem('searchrecord') || [];
                        if(recordlist.indexOf(input)>-1){
                            recordlist = recordlist.filter((item) => item !== input);
                        }
                        recordlist.unshift(input);
                        if(recordlist.length>20){
                            recordlist.splice(recordlist.length-1,1);
                        }
                        storage0.setItem('searchrecord', recordlist);
                    }
                    refreshPage(true);
                }
            }),
            desc: descarr[Math.floor(Math.random() * descarr.length)],
            col_type: "input",
            extra: {
                defaultValue: getMyVar('SrcJu_sousuoName',keyword||''),
                titleVisible: true
            }
        });
        let searchTypes = getTypeNames("ÊêúÁ¥¢È°µ");
        searchTypes.forEach((it) =>{
            let obj = {
                title: getMyVar("SrcJu_sousuoType",searchtype||runMode)==it?`‚Äú‚Äú‚Äù‚Äù<b><span style="color: #3399cc">`+it+`</span></b>`:it,
                url: $('#noLoading#').lazyRule((it) => {
                    putMyVar("SrcJu_sousuoType",it);
                    refreshPage(false);
                    return "hiker://empty";
                },it),
                col_type: 'text_5'
            }
            if(it=="ÂΩ±ËßÜ" && name){
                obj.extra = {};
                obj["extra"].longClick = [{
                    title:"üîçËÅöÂΩ±ÊêúÁ¥¢",
                    js: $.toString((url)=>{
                        return url;
                    }, JySearch(name, getItem("juyingSeachType")))
                }];
            }
            d.push(obj);
        })

        let recordlist = storage0.getItem('searchrecord') || [];
        if(recordlist.length>0){
            d.push({
                title: 'üóëÊ∏ÖÁ©∫',
                url: $('#noLoading#').lazyRule(() => {
                    clearItem('searchrecord');
                    deleteItemByCls('searchrecord');
                    return "toast://Â∑≤Ê∏ÖÁ©∫";
                }),
                col_type: 'flex_button',//scroll_button
                extra: {
                    cls: 'searchrecord'
                }
            });
        }else{
            d.push({
                title: '‚ÜªÊó†ËÆ∞ÂΩï',
                url: "hiker://empty",
                col_type: 'flex_button',
                extra: {
                    cls: 'searchrecord'
                }
            });
        }
        recordlist.forEach(item=>{
            d.push({
                title: item,
                url: $().lazyRule((input) => {
                    putMyVar('SrcJu_sousuoName',input);
                    refreshPage(true);
                    return "hiker://empty";
                },item),
                col_type: 'flex_button',
                extra: {
                    cls: 'searchrecord'
                }
            });
        })
    }
    d.push({
        title: "",
        col_type: 'text_center_1',
        url: "hiker://empty",
        extra: {
            id: "sousuoloading"+getMyVar('SrcJu_sousuoType', searchtype||runMode),
            lineVisible: false
        }
    });
    setResult(d);
    
    if(name){
        deleteItemByCls('searchrecord');
        let info = storage0.getMyVar('‰∏ÄÁ∫ßÊ∫êÊé•Âè£‰ø°ÊÅØ') || {};
        let type = getMyVar("SrcJu_sousuoType", searchtype||info.type);
        search(name,"sousuopage",false,info.group,type);
    }
}